# FastAPI
* ë¹ ë¦„: Starlette + Pydanticì— ì˜í•´ NodeJS, Goì™€ ëŒ€ë“±í•  ì •ë„ë¡œ ë¹ ë¦„
* íƒ€ì… ê²€ì¦: Python íƒ€ì… íŒíŠ¸ë¥¼ í™œìš©í•œ ìë™ ë°ì´í„° ê²€ì¦
* ë¬¸ì„œí™” ìë™ ìƒì„±: Swagger UIì™€ ReDocì„ ìë™ ì œê³µ
* ë¹„ë™ê¸° ì§€ì›: `async`/`await` ì§€ì›ìœ¼ë¡œ ë†’ì€ ë™ì‹œì„± ì²˜ë¦¬

<br>
<br>
<br>
<br>

# 1. FastAPIê°€ ë¹ ë¥¸ ì´ìœ : `Starlette` + `Pydantic`
* Python ê¸°ë°˜ ì›¹í”„ë ˆì„ì›Œí¬ê°€ Node.jsì™€ Goì™€ ëŒ€ë“±í•  ì •ë„ë¡œ ë¹ ë¥¸ ì´ìœ 

<br>
<br>
<br>
<br>

## A. Starlette = ì´ˆê²½ëŸ‰ ë¹„ë™ê¸° í”„ë ˆì„ì›Œí¬
* FastAPIì˜ HTTP ìš”ì²­ ì²˜ë¦¬ ì—”ì§„: **Starlette**

* FastAPIì˜ ê¸°ë°˜ ì›¹ì„œë²„

* ë§¤ìš° ê²½ëŸ‰(ì•½ 5k LOC)ì´ê³  ë¹ ë¦„
> * Starlette ìì²´ê°€ ë§¤ìš° ì–†ì€ ì¶”ìƒí™” ê³„ì¸µ - ì˜ì¡´ì„± ìµœì†Œí™”
> * ë¶ˆí•„ìš”í•œ ì˜¤ë²„í—¤ë“œ ì—†ìŒ

* Pythonì˜ async/await ë¹„ë™ê¸° I/O í’€ ì§€ì›
> * Pythonì˜ `asyncio`ë¥¼ 100% í™œìš©
> * ë§ì€ ìš”ì²­ì„ í•œêº¼ë²ˆì— ì²˜ë¦¬ ê°€ëŠ¥ (FlaskëŠ” ë™ê¸° ë°©ì‹ì´ë¼ ì²˜ë¦¬ëŸ‰ ë‚®ìŒ)

* ASGI (Asynchronous Server Gateway Interface) ê¸°ë°˜
> * WSFI(Flask, Django)ë³´ë‹¤ ì§„ë³´ëœ ì¸í„°í˜ì´ìŠ¤

* WebSocket, HTTP2, Server-Sent Events(SSE) ê°™ì€ ìµœì‹  í”„ë¡œí† ì½œ ì§€ì›

<br>
<br>

### A-1. Starletteì™€ Flaskì˜ ë¹„ë™ê¸°/ë™ê¸° ì²˜ë¦¬ ë°©ì‹ ë¹„êµ

* Starlette (ë¹„ë™ê¸°: Non-blocking)
> * `asyncio.sleep(1)`ë¡œ 1ì´ˆ ëŒ€ê¸°í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ìš”ì²­ ë°›ì„ ìˆ˜ ìˆìŒ

```python
# starlette_example.py
import asyncio
from starlette.applications import Starlette
from starlette.responses import JSONResponse
from starlette.routing import Route

async def homepage(request):
    await asyncio.sleep(1)  # I/O ì‘ì—…ì„ ë¹„ë™ê¸°ë¡œ ì‹œë®¬ë ˆì´ì…˜
    return JSONResponse({'hello': 'world'})

routes = [
    Route("/", endpoint=homepage),
]

app = Starlette(debug=True, routes=routes)
```

<br>

* Flask (ë™ê¸°: Blocking)
> * `time.sleep(1)`ìœ¼ë¡œ 1ì´ˆ ëŒ€ê¸°í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ëª¨ë“  ìš”ì²­ì´ ëŒ€ê¸° ìƒíƒœì— ë¹ ì§

```python
# flask_example.py
import time
from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/')
def homepage():
    time.sleep(1)  # I/O ì‘ì—…ì„ ë™ê¸°ë¡œ ì‹œë®¬ë ˆì´ì…˜
    return jsonify({'hello': 'world'})

```

<br>
<br>
<br>
<br>

## B. WSGI vs ASGI ë¹„êµ

|êµ¬ë¶„|WSGI|ASGI|
|---|---|---|
|ì²˜ë¦¬ ë°©ì‹|ë™ê¸°(Synchronous)|ë¹„ë™ê¸°(Asynchronous) ì§€ì›|
|ì§€ì› í”„ë¡œí† ì½œ|HTTP 1.1|HTTP 1.1, HTTP/2, WebSocket|
|ì˜ˆ|Flask, Django (êµ¬ë²„ì „)|FastAPI, Starlette, Django 3+|
|í•œê³„|ë™ì‹œì„± ì²˜ë¦¬ ë¶ˆê°€|ë‹¤ìˆ˜ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì²˜ë¦¬ ê°€ëŠ¥|

* WSGIëŠ” ë‹¨ì¼ ì°¨ì„  ë„ë¡œ - í•œ ë²ˆì— í•œ ëŒ€ë§Œ í†µê³¼
* ASGIëŠ” ë©€í‹°ë ˆì¸ ê³ ì†ë„ë¡œ - ìˆ˜ë§ì€ ì°¨ëŸ‰(ìš”ì²­)ì„ ë™ì‹œ ì²˜ë¦¬

<br>
<br>

### B-1. ìš”ì²­ ì²˜ë¦¬ íë¦„ (FastAPI + Uvicorn)
* FastAPIëŠ” Starless ê¸°ë°˜ì´ë©°, StarletteëŠ” ASGI ì„œë²„ë§Œ ì§€ì›
> * HTTP ìš”ì²­ ì²˜ë¦¬ ê°€ëŠ¥
> * WebSocket ì§€ì› ê°€ëŠ¥
> * Background Tasks ì²˜ë¦¬ ê°€ëŠ¥

```scss
[í´ë¼ì´ì–¸íŠ¸ ìš”ì²­]
      â†“
(Uvicorn - ASGI ì„œë²„)
      â†“
Starlette (ë¼ìš°íŒ…, ë¯¸ë“¤ì›¨ì–´)
      â†“
FastAPI (ì—”ë“œí¬ì¸íŠ¸ ì‹¤í–‰)
      â†“
[í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ]
```
* Uvicorn = ASGI ì„œë²„ ì—­í• 
* FastAPIëŠ” ASGI ì• í”Œë¦¬ì¼€ì´ì…˜ ì—­í• 

<br>
<br>

### B-2. ì½”ë“œë¡œ ë³´ëŠ” ASGI ì•±
* ASGI ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘

```python
async def app(scope, receive, send):
    assert scope["type"] == "http"

    await send({
        "type": "http.response.start",
        "status": 200,
        "headers": [
            [b"content-type", b"text/plain"]
        ]
    })
    await send({
        "type": "http.response.body",
        "body": b"Hello, ASGI World!",
    })

```
* `scope`: ìš”ì²­ ì •ë³´ (ë©”ì„œë“œ, ê²½ë¡œ ë“±)
* `recive`: í´ë¼ì´ì–¸íŠ¸ ë©”ì‹œì§€ ë°›ê¸°
* `send`: í´ë¼ì´ì–¸íŠ¸ë¡œ ë©”ì‹œì§€ ë³´ë‚´ê¸°

* I/O Bound ë¹„ë™ê¸° ì²˜ë¦¬ ì‹¤ìŠµ ì½”ë“œ

```python
import httpx
from fastapi import FastAPI

app = FastAPI()

@app.get("/async-data")
async def fetch_data():
    async with httpx.AsyncClient() as client:
        response = await client.get("https://httpbin.org/get")
        return response.json()
```

<br>
<br>

### B-3. ASGI ì£¼ìš” íŠ¹ì§•

|íŠ¹ì§•|ì„¤ëª…|
|---|---|
|ë¹„ë™ê¸° ì§€ì›|async/awaitë¡œ ìˆ˜ì²œ ê°œ ìš”ì²­ ë™ì‹œì— ì²˜ë¦¬|
|ë©€í‹°í”„ë¡œí† ì½œ ì§€ì›|HTTP, WebSocket, SSE ì²˜ë¦¬ ê°€ëŠ¥|
|ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜|ìš”ì²­-ì‘ë‹µ ë¿ ì•„ë‹ˆë¼ ì¥ê¸° ì—°ê²° ì§€ì›|
|ë¹ ë¥¸ ì²˜ë¦¬ ì†ë„|Starlette, FastAPI, Django Channels ì‚¬ìš©|

<br>
<br>

### B-4. ASGI ì„œë²„ ì¢…ë¥˜

|ì„œë²„|íŠ¹ì§•|
|---|---|
|Uvicorn|ê°€ë³ê³  ë¹ ë¥¸ ASGI ì„œë²„|
|Daphne|Django Channelsì—ì„œ ì‚¬ìš©|
|Hypercorn|HTTP/2, WebSocket ì§€ì› ê°•í™”|

<br>
<br>
<br>
<br>

## C. Pydantic = ì´ˆê³ ì† ë°ì´í„° ê²€ì¦ê¸°

* ë°ì´í„° íŒŒì‹±ê³¼ ê²€ì¦ ë‹´ë‹¹

* JSON â†’ Python ê°ì²´ë¡œ ë³€í™˜
* íƒ€ì… ê²€ì‚¬ ë° ìœ íš¨ì„± ê²€ì¦
* ê¸°ë³¸ê°’, í˜• ë³€í™˜, í•„ë“œ ê²€ì¦

<br>

### C-1. ë¹ ë¥¸ ì´ìœ 
1. Cython ìµœì í™”
> * ë‚´ë¶€ì—ì„œ CPython/Cythonìœ¼ë¡œ ì²˜ë¦¬
> * Pythonì˜ ìˆœìˆ˜ dict parsingë³´ë‹¤ í›¨ì”¬ ë¹ ë¥¸

2. íƒ€ì… íŒíŠ¸ ì‚¬ìš©
> * Python íƒ€ì… íŒíŠ¸ë¥¼ í™œìš©í•´ ë™ì  ê²€ì¦ ë¡œì§ ì œê±°
> * ì»´íŒŒì¼ íƒ€ì„ì— ë°ì´í„° ìœ íš¨ì„± ê·œì¹™ ì¤€ì§€

3. Lazy Validation
> * ìš”ì²­ì´ ì˜¬ ë•Œ í•„ìš”í•œ ë§Œí¼ë§Œ ê²€ì¦

<br>

### C-2. ì˜ˆì œ: ë°ì´í„° íŒŒì‹± ì†ë„

```python
from pydantic import BaseModel

class User(BaseModel):
    id: int
    name: str
    email: str

# idë¥¼ intë¡œ ìë™ ë³€í™˜í•˜ê³  ê²€ì¦ê¹Œì§€ ìˆ˜í–‰
u = User(id="1", name="Alice", email="alice@example.com")
```

* ìœ„ì™€ ê°™ì€ ë³€í™˜ì„ Flaskì—ì„œëŠ” ìˆ˜ë™ìœ¼ë¡œ í•´ì•¼ í•¨
* Pydanticì€ 10ë°° ì´ìƒ ë¹ ë¥´ê²Œ ì²˜ë¦¬ ê°€ëŠ¥

<br>
<br>
<br>
<br>

## D. Pydantic ì‹¬í™”
* `Field` : ìš”ì²­ ë°ì´í„°ì—ì„œ ê° í•„ë“œì˜ ì œì•½ ì¡°ê±´ ì •ì˜
* `validator`ë¡œ ì»¤ìŠ¤í…€ ê²€ì¦ : í•œ í•„ë“œ ë˜ëŠ” ì—¬ëŸ¬ í•„ë“œ ê°„ ê²€ì¦ ë¡œì§ ì¶”ê°€ ì‹œ ì‚¬ìš©
* `Nested` ëª¨ë¸ (ì¤‘ì²© ìŠ¤í‚¤ë§ˆ) : ìš”ì²­ JSONì´ ì¤‘ì²©ëœ êµ¬ì¡°ì¸ ê²½ìš°, ëª¨ë¸ ì•ˆì— ëª¨ë¸ë¡œ ì²˜ë¦¬

<br>

|ê¸°ëŠ¥|ì˜ˆì œ|ì„¤ëª…|
|---|---|---|
|Field ì˜µì…˜|`Field(..., gt=0, max_length=50)`|í•„ë“œ ë‹¨ìœ„ ìœ íš¨ì„± ê²€ì¦, Swagger ë¬¸ì„œí™” ë°˜ì˜|
|@validator|ì»¤ìŠ¤í…€ ë¡œì§ êµ¬í˜„|í•œ í•„ë“œ ë˜ëŠ” ì—¬ëŸ¬ í•„ë“œ ê°„ ê²€ì¦ ë¡œì§ ì¶”ê°€|
|Nested ëª¨ë¸|ëª¨ë¸ ì•ˆì— ëª¨ë¸ ì •ì˜|ì¤‘ì²© JSON êµ¬ì¡° ëŒ€ì‘|

<br>
<br>

### D-1. Field
* ë§¤ê°œë³€ìˆ˜

|ì˜µì…˜|ì„¤ëª…|
|---|---|
|`...`|í•„ìˆ˜ í•„ë“œ í‘œì‹œ(required)|
|`title`|Swagger ë¬¸ì„œì— í•„ë“œ ì œëª©ìœ¼ë¡œ í‘œì‹œ|
|`description`|Swagger ë¬¸ì„œì— í•„ë“œ ì„¤ëª… ì¶”ê°€|
|`max_length`|ë¬¸ìì—´ ìµœëŒ€ ê¸¸ì´|
|`gt`,`ge`|ìˆ«ì > (greater than), >= (greater equal)|
|`lt`,`le`|ìˆ«ì < (lower than), <= (lower equal)|
|`default`|ê¸°ë³¸ê°’ ì§€ì •|

<br>

### D-2. ì˜ˆì œ ì½”ë“œ
```python
from fastapi import FastAPI
from pydantic import BaseModel, Field

app = FastAPI()

class Item(BaseModel):
    name: str = Field(..., title="ì•„ì´í…œ ì´ë¦„", max_length=50)
    price: float = Field(..., gt=0, description="ê°€ê²©ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•¨")
    quantity: int = Field(default=1, ge=1, le=100, description="1~100 ì‚¬ì´")

@app.post("/items/")
def create_item(item: Item):
    return item
```

<br>

* ì •ìƒ ìš”ì²­
```json
POST /items/
{
    "name": "FastAPI ì´ˆë³´ íƒˆì¶œ",
    "price": 9.99,
    "quantity": 10
}
```

<br>

* ì˜ëª»ëœ ìš”ì²­
```json
POST /items/
{
    "name": "ì´ë¦„ì´ ë§¤ìš°ë§¤ìš°ë§¤ìš°ë§¤ìš°ë§¤ìš°ë§¤ìš° ê¸¸ë‹¤aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
    "price": -1,
    "quantity": 101
}
```

<br>

* ì‘ë‹µ
```json
{
    "detail": [
        {"loc": ["body", "name"], "msg": "ensure this value has at most 50 characters", "type": "value_error.any_str.max_length"},
        {"loc": ["body", "price"], "msg": "ensure this value is greater than 0", "type": "value_error.number.not_gt"},
        {"loc": ["body", "quantity"], "msg": "ensure this value is less than or equal to 100", "type": "value_error.number.not_le"}
    ]
}
```

<br>
<br>

### D-3. `@validator`ë¡œ ì»¤ìŠ¤í…€ ê²€ì¦
```python
from pydantic import BaseModel, validator

class User(BaseModel):
    username: str
    email: str

    @validator("email")
    def validate_email(cls, v):
        if "@" not in v:
            raise ValueError("ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.")
        return v

@app.post("/users/")
def create_user(user: User):
    return user
```

<br>

* ì •ìƒ ìš”ì²­
```json
POST /users/
{
    "username": "junedev",
    "email": "june@example.com"
}
```

<br>

* ì˜ëª»ëœ ìš”ì²­
```json
POST /users/
{
    "username": "junedev",
    "email": "not-an-email"
}
```

<br>

* ì‘ë‹µ
```json
{
    "detail": [
        {"loc": ["body", "email"], "msg": "ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.", "type": "value_error"}
    ]
}
```

<br>

* ê³ ê¸‰: ì—¬ëŸ¬ í•„ë“œ ì˜ì¡´ ê²€ì¦
```python
class Product(BaseModel):
    price: float
    discount: float

    @validator("discount")
    def discount_must_be_less_than_price(cls, v, values):
        if "price" in values and v >= values["price"]:
            raise ValueError("í• ì¸ì€ ê°€ê²©ë³´ë‹¤ ì‘ì•„ì•¼ í•©ë‹ˆë‹¤.")
        return v
```

<br>
<br>

### D-4. Nested ëª¨ë¸ (ì¤‘ì²© ìŠ¤í‚¤ë§ˆ)
### ì˜ˆì œ ì½”ë“œ
```python
class Address(BaseModel):
    street: str
    city: str
    zipcode: str = Field(..., regex="^\\d{5}$")

class Order(BaseModel):
    item_name: str
    quantity: int = Field(..., gt=0)
    shipping_address: Address

@app.post("/orders/")
def create_order(order: Order):
    return order
```

<br>

* ì •ìƒ ìš”ì²­
```json
POST /orders/
{
    "item_name": "FastAPI êµì¬",
    "quantity": 2,
    "shipping_address": {
        "street": "ì¤‘ì•™ë¡œ 123",
        "city": "ì„œìš¸",
        "zipcode": "12345"
    }
}
```

<br>

* ì˜ëª»ëœ ìš”ì²­
```json
POST /orders/
{
    "item_name": "FastAPI êµì¬",
    "quantity": 0,
    "shipping_address": {
        "street": "ì¤‘ì•™ë¡œ 123",
        "city": "ì„œìš¸",
        "zipcode": "abcde"
    }
}
```

<br>

* ì‘ë‹µ
```json
{
    "detail": [
        {"loc": ["body", "quantity"], "msg": "ensure this value is greater than 0", "type": "value_error.number.not_gt"},
        {"loc": ["body", "shipping_address", "zipcode"], "msg": "string does not match regex \"^\\d{5}$\"", "type": "value_error.str.regex"}
    ]
}
```

<br>
<br>
<br>
<br>

## E. FastAPIì˜ ìš”ì²­ ì²˜ë¦¬ ìˆœì„œ
```
í´ë¼ì´ì–¸íŠ¸ ìš”ì²­
   â†“
ASGI ì„œë²„(Uvicorn)
   â†“
Starletteê°€ ìš”ì²­ ì²˜ë¦¬
   â†“
FastAPI ë¼ìš°í„°ì—ì„œ ê²½ë¡œ ë§¤ì¹­
   â†“
Pydanticìœ¼ë¡œ ìš”ì²­ ë°ì´í„° ê²€ì¦ & íŒŒì‹±
   â†“
ì—”ë“œí¬ì¸íŠ¸ í•¨ìˆ˜ í˜¸ì¶œ (sync/async)
   â†“
Pydanticìœ¼ë¡œ ì‘ë‹µ ë°ì´í„° ê²€ì¦
   â†“
ASGI ì„œë²„ê°€ ì‘ë‹µ ë°˜í™˜
```
* Pydanticì´ ìš”ì²­/ì‘ë‹µ ê²€ì¦ ë‹´ë‹¹
* Starletteê°€ ë¼ìš°íŒ…/ë¯¸ë“¤ì›¨ì–´/ë¹„ë™ê¸° ì²˜ë¦¬ ë‹´ë‹¹
> ìš”ì²­ì˜ ëª¨ë“  ê³¼ì •ì´ íƒ€ì… ì•ˆì „ + ë¹„ë™ê¸° ìµœì í™” ë˜ì–´ ìˆëŠ” êµ¬ì¡°

<br>
<br>
<br>
<br>

## F. ìš”ì•½: Node.js / Goì™€ ëŒ€ë“±í•œ ì„±ëŠ¥
* FastAPI = Starlette(ë¹„ë™ê¸°) + Pydantic(ë°ì´í„° ê²€ì¦)ì˜ ì¡°í•©
* ë‹¨ìˆœ JSON APIë¼ë©´ Node.js, Goì™€ ë™ê¸‰ ì²˜ë¦¬ëŸ‰
* I/O bound ì‘ì—…(DB, ì™¸ë¶€ API í˜¸ì¶œ ë“±)ì—ì„œ íŠ¹íˆ ê°•ë ¥
* ë‹¨ì : Python ìì²´ê°€ GIL ë•Œë¬¸ì— CPU bound ì‘ì—…ì€ Goë³´ë‹¤ ëŠë¦¼

<br>

|ìš”ì†Œ|FastAPI|
|---|---|
|ìš”ì²­ ì²˜ë¦¬ ì—”ì§„|Starlette (ASGI ê¸°ë°˜ ì´ˆê²½ëŸ‰ ë¹„ë™ê¸° í”„ë ˆì„ì›Œí¬)|
|ë°ì´í„° ê²€ì¦|Pydantic (Cython ìµœì í™”ëœ ì´ˆê³ ì† íŒŒì„œ)|
|ì¥ì |Node.js/Goì— ë§ë¨¹ëŠ” I/O ì²˜ë¦¬ ì„±ëŠ¥|
|í•œê³„|CPU ì—°ì‚° ë§ì„ ë• Goê°€ ì—¬ì „íˆ ìš°ìœ„|

<br>
<br>
<br>
<br>

## G. FastAPI ìš”ì²­ ì²˜ë¦¬ ì‹¤í–‰ ìˆœì„œ
* FastAPIê°€ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ë°›ì•„ ì‘ë‹µì„ ë°˜í™˜í•˜ê¸°ê¹Œì§€ì˜ ì „ì²´ ì²˜ë¦¬ íë¦„

```css
[í´ë¼ì´ì–¸íŠ¸ ìš”ì²­]
      â†“
[ASGI ì„œë²„(Uvicorn)]
      â†“
[ë¯¸ë“¤ì›¨ì–´ ì‹¤í–‰ (ì˜ˆ: ë¡œê¹…, ì¸ì¦, CORS)]
      â†“
[ë¼ìš°í„°(Route)ì—ì„œ ê²½ë¡œ ë§¤ì¹­]
      â†“
[ì˜ì¡´ì„± ì£¼ì…(Dependency Injection)]
      â†“
[Pydantic ìš”ì²­ ë°ì´í„° ê²€ì¦ ë° íŒŒì‹±]
      â†“
[ì—”ë“œí¬ì¸íŠ¸ í•¨ìˆ˜ ì‹¤í–‰(sync/async)]
      â†“
[Pydantic ì‘ë‹µ ë°ì´í„° ì§ë ¬í™”]
      â†“
[ASGI ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µ ë°˜í™˜]
```

<br>

| ë‹¨ê³„| ì„¤ëª…|
| --- | ---- |
| **ASGI ì„œë²„(Uvicorn)** | ë¹„ë™ê¸° ìš”ì²­ ì²˜ë¦¬ ë° ì´ë²¤íŠ¸ ë£¨í”„ ê´€ë¦¬ (`asyncio` ê¸°ë°˜)|
| **ë¯¸ë“¤ì›¨ì–´**| ìš”ì²­ ì „/í›„ ê³µí†µ ì²˜ë¦¬ (ë¡œê¹…, ì—ëŸ¬ í•¸ë“¤ë§, CORS ë“±)|
| **ë¼ìš°í„°(Route)**| URL ê²½ë¡œì™€ HTTP ë©”ì„œë“œ(GET, POST ë“±) ê¸°ë°˜ìœ¼ë¡œ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ì„ íƒ|
| **ì˜ì¡´ì„± ì£¼ì…(DI)**| í•¨ìˆ˜ ì‹¤í–‰ ì „ì— í•„ìš”í•œ ê°ì²´(ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ë“±) ìƒì„± ë° ì£¼ì…|
| **Pydantic ìš”ì²­ ê²€ì¦**| ìš”ì²­ ë°ì´í„°ì˜ íƒ€ì… ë° ìœ íš¨ì„± ê²€ì‚¬ (JSON â†’ Python ê°ì²´ ë³€í™˜)|
| **ì—”ë“œí¬ì¸íŠ¸ ì‹¤í–‰**| ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰ (`async def` ë˜ëŠ” `def`)|
| **Pydantic ì‘ë‹µ ì§ë ¬í™”**| Python ê°ì²´ â†’ JSON ë³€í™˜ í›„ ë°˜í™˜|
| **ASGI ì‘ë‹µ ë°˜í™˜**| ìµœì¢… HTTP ì‘ë‹µì„ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬|


<br>
<br>
<br>
<br>

## H. ë¬¸ì„œí™” ìë™ ìƒì„± ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•

* FastAPIëŠ” OpenAPI ìŠ¤í™ ê¸°ë°˜ìœ¼ë¡œ API ë¬¸ì„œë¥¼ ìë™ ìƒì„±
* ê°œë°œìëŠ” ë³„ë„ ë¬¸ì„œ ì‘ì„± ì—†ì´ ì½”ë“œë§Œìœ¼ë¡œ ìµœì‹  ë¬¸ì„œë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìœ¼ë©°, Swagger UI ë° ReDocì—ì„œ APIë¥¼ ì¸í„°ë™í‹°ë¸Œí•˜ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŒ

| ë¬¸ì„œí™” ë„êµ¬| ì„¤ëª…| URL|
| --- | --- | --- |
| **Swagger UI** | API í…ŒìŠ¤íŠ¸ ë° ìƒí˜¸ì‘ìš© ê°€ëŠ¥ | `http://127.0.0.1:8000/docs`|
| **ReDoc**| ì½ê¸° ì¢‹ì€ ë¬¸ì„œí™” ë·°ì–´| `http://127.0.0.1:8000/redoc`|

<br>

* ë¬¸ì„œ ìë™ ì»¤ìŠ¤í„°ë§ˆì´ì§• ë²”ìœ„

| ê¸°ëŠ¥| ê¸°ì¡´ | ë³´ê°• í›„|
| --- | -- | --- |
| ë¬¸ì„œ ë©”íƒ€ë°ì´í„°| âœ…  | âœ… + ì—°ë½ì²˜/ë¼ì´ì„ ìŠ¤ ì¶”ê°€|
| íƒœê·¸ ê·¸ë£¹í™”| âœ…  | âœ… ìœ ì§€|
| ìƒì„¸ ì„¤ëª…/ì‘ë‹µ ëª¨ë¸| âœ…  | âœ… Docstring ë§ˆí¬ë‹¤ìš´ í¬í•¨|
| Swagger UI ì»¤ìŠ¤í„°ë§ˆì´ì§• | âŒ  | âœ… defaultModelsExpandDepth ë“±|
| ë‚´ë¶€ API ìˆ¨ê¹€ ì²˜ë¦¬| âŒ  | âœ… include\_in\_schema=False ì¶”ê°€ |
| OAuth2 ì¸ì¦ ë²„íŠ¼| âŒ  | âœ… ì‹¤ì „ ì¸ì¦ ë²„íŠ¼ ì¶”ê°€|


<br>
<br>

### H-1. ë¬¸ì„œ ì •ë³´ ì»¤ìŠ¤í„°ë§ˆì´ì§•
* FastAPI ê°ì²´ ìƒì„± ì‹œ API ë¬¸ì„œì˜ ì œëª©, ì„¤ëª…, ë²„ì „, ì—°ë½ì²˜ ë“± ì •ì˜ ê°€ëŠ¥

```python
from fastapi import FastAPI

app = FastAPI(
    title="ë‚˜ì˜ ë©‹ì§„ API",
    description="ì´ APIëŠ” ì‚¬ìš©ì ê´€ë¦¬ì™€ ì•„ì´í…œ ê´€ë¦¬ë¥¼ ìœ„í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ğŸš€",
    version="1.0.0",
    contact={
        "name": "JuneDev",
        "url": "https://github.com/junedev",
        "email": "june@example.com",
    },
    license_info={
        "name": "Apache 2.0",
        "url": "https://www.apache.org/licenses/LICENSE-2.0.html",
    },
)

@app.get("/")
def read_root():
    return {"Hello": "World"}
```

* ì´ë ‡ê²Œ ì¶”ê°€ëœ ì •ë³´ëŠ” `/docs`ì™€ `/redoc` ìƒë‹¨ì— í‘œì‹œë˜ì–´ APIì˜ ëª©ì ê³¼ ë‹´ë‹¹ì, ë¼ì´ì„ ìŠ¤ ì •ë³´ ëª…í™•íˆ ì „ë‹¬
> * Swagger UI/ReDoc ìƒë‹¨ì— ë©”íƒ€ë°ì´í„°ê°€ ë…¸ì¶œë˜ì–´ API ì‹ ë¢°ë„ ìƒìŠ¹

<br>
<br>

### H-2. íƒœê·¸(Tags)ë¥¼ ì´ìš©í•œ API ê·¸ë£¹í™”

* ê´€ë ¨ ê¸°ëŠ¥ë¼ë¦¬ ë¬¶ì–´ì„œ ë³´ê¸° ì¢‹ê²Œ ë¬¸ì„œí™”
> * `tags` íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê·¸ë£¹í™”í•  ìˆ˜ ìˆìŒ

<br>

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/users/", tags=["Users"])
async def get_users():
    return [{"name": "Harry"}, {"name": "Ron"}]

@app.get("/items/", tags=["Items"])
async def get_items():
    return [{"name": "Magic Wand"}, {"name": "Flying Broom"}]

@app.post("/items/", tags=["Items"])
async def create_item(item: dict):
    return item
```

* ìœ„ì™€ ê°™ì´ ì„¤ì •í•˜ë©´ Swagger UIì—ì„œ "Users"ì™€ "Items"ë¼ëŠ” ì„¹ì…˜ì´ ìƒê²¨ APIë¥¼ í›¨ì”¬ ì‰½ê²Œ íƒìƒ‰ ê°€ëŠ¥

<br>
<br>

### H-3. ìƒì„¸ ì„¤ëª… ë° ì‘ë‹µ ëª¨ë¸ ëª…ì‹œ

* ì—”ë“œí¬ì¸íŠ¸ë³„ ìš”ì•½(`summary`), ì„¤ëª…(`description`), ì‘ë‹µ(`response_description`) ë“±ì„ ì¶”ê°€í•´ ë¬¸ì„œë¥¼ í’ë¶€í•˜ê²Œ í•  ìˆ˜ ìˆìŒ
* `response_model`ì„ ì§€ì •í•˜ë©´ ì‘ë‹µ ë°ì´í„°ì˜ êµ¬ì¡°ë¥¼ ëª…í™•íˆ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŒ

```python
from fastapi import FastAPI
from pydantic import BaseModel

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float
    tax: float | None = None

app = FastAPI()

@app.post(
    "/items/",
    response_model=Item,
    tags=["Items"],
    summary="ìƒˆë¡œìš´ ì•„ì´í…œ ìƒì„±",
    description="ë°ì´í„°ë² ì´ìŠ¤ì— ìƒˆë¡œìš´ ì•„ì´í…œì„ ìƒì„±í•˜ê³  ìƒì„±ëœ ì•„ì´í…œ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.",
    response_description="ì„±ê³µì ìœ¼ë¡œ ìƒì„±ëœ ì•„ì´í…œ ì •ë³´",
)
async def create_item(item: Item):
    """
    ìƒˆë¡œìš´ ì•„ì´í…œì„ ìƒì„±í•©ë‹ˆë‹¤:

    - **name**: ì•„ì´í…œì˜ ì´ë¦„ (í•„ìˆ˜)
    - **description**: ì•„ì´í…œì— ëŒ€í•œ ì„¤ëª… (ì„ íƒ)
    - **price**: ì•„ì´í…œ ê°€ê²© (í•„ìˆ˜)
    - **tax**: ì„¸ê¸ˆ (ì„ íƒ)
    """
    return item
```

* Swagger UIì—ì„œ í•¨ìˆ˜ Docstringë„ ë§ˆí¬ë‹¤ìš´ ì§€ì›

<br>
<br>

### H-4. Swagger UI ê³ ê¸‰ ì»¤ìŠ¤í„°ë§ˆì´ì§•
* `swagger_ui_parameters`ë¡œ Swaggerì˜ UI ë™ì‘ ì œì–´

```python
app = FastAPI(
    swagger_ui_parameters={
        "defaultModelsExpandDepth": -1,  # ëª¨ë¸ ì ‘ê¸°
        "docExpansion": "none",         # API ëª©ë¡ ì ‘ê¸°
        "filter": True                  # ê²€ìƒ‰ í•„í„° í™œì„±í™”
    }
)
```

| ì˜µì…˜| ì„¤ëª…|
| --- | --- |
| `defaultModelsExpandDepth` | ëª¨ë¸ ì„¹ì…˜ ê¸°ë³¸ í¼ì¹¨ ê¹Šì´ ì„¤ì •|
| `docExpansion`| `list`, `full`, `none`ë¡œ ì ‘í˜ ì¡°ì ˆ |
| `filter`| API ëª©ë¡ ê²€ìƒ‰ì°½ ì¶”ê°€|

<br>
<br>

### H-5. ë‚´ë¶€ API ìˆ¨ê¹€ ì²˜ë¦¬
* ê°œë°œììš© APIë¥¼ ë¬¸ì„œì—ì„œ ì œì™¸

```python
@app.get("/internal", include_in_schema=False)
async def internal_api():
    return {"message": "ìˆ¨ê¹€ API"}
```

<br>
<br>

### H-6. OAuth2 ì¸ì¦ ë²„íŠ¼ ì¶”ê°€
* Swagger UIì— â€œAuthorizeâ€ ë²„íŠ¼ í‘œì‹œ

```python
from fastapi.security import OAuth2PasswordBearer

oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")

@app.get("/users/me")
async def read_users_me(token: str = Depends(oauth2_scheme)):
    return {"token": token}
```
