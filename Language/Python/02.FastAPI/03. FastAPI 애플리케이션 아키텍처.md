# 3. FastAPI ë¼ìš°í„° êµ¬ì¡° ë¶„ë¦¬ (ëª¨ë“ˆí™”)
* FastAPI ìì²´ëŠ” "íŒŒì¼ëª…", "ë¼ìš°í„° êµ¬ì¡°"ì— ê°•ì œ ê·œì¹™ì´ ìˆì§€ ì•ŠìŒ
> * FastAPIëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ê·¸ëƒ¥ Python íŒ¨í‚¤ì§€ì´ë¯€ë¡œ, íŒŒì¼ëª…ì„ ë§ˆìŒëŒ€ë¡œ ì§€ì–´ë„ ë™ì‘
* ê·¸ëŸ¬ë‚˜ í˜‘ì—… ë° ìœ ì§€ë³´ìˆ˜ë¥¼ ê³ ë ¤í•˜ì˜€ì„ ë•Œ, "ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤"ë¥¼ ë”°ë¥´ëŠ” ê²ƒì´ ì¢‹ìŒ
> * ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì˜ í˜‘ì—… ê³ ë ¤
> * Swagger ë¬¸ì„œì™€ ì½”ë“œ êµ¬ì¡° ì¼ê´€ì„± ìœ ì§€

<br>
<br>
<br>
<br>

## A. ì¶”ì²œ êµ¬ì¡°
```bash
project/
â”œâ”€â”€ main.py                 # FastAPI ì•± ì§„ì…ì 
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/               # ì „ì—­ ì„¤ì • ë° ë³´ì•ˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py       # í™˜ê²½ ë³€ìˆ˜ ë° ì„¤ì • ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ security.py     # ë³´ì•ˆ ê´€ë ¨ ìœ í‹¸ë¦¬í‹° (í•´ì‹œ ë“±)
â”‚   â”‚
â”‚   â”œâ”€â”€ dependencies/       # ê³µí†µ ì˜ì¡´ì„± ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py         # ì¸ì¦ ê´€ë ¨ Depends í•¨ìˆ˜
â”‚   â”‚   â”œâ”€â”€ db.py           # DB ì„¸ì…˜ ê´€ë¦¬ Depends
â”‚   â”‚   â””â”€â”€ common.py       # ê¸°íƒ€ ê³µí†µ ìœ í‹¸ë¦¬í‹° Depends
â”‚   â”‚
â”‚   â”œâ”€â”€ models/             # ORM DB ëª¨ë¸ ì •ì˜
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ users.py
â”‚   â”‚   â””â”€â”€ items.py
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/       # DB ì ‘ê·¼ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user_repo.py
â”‚   â”‚   â””â”€â”€ item_repo.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/           # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user_service.py
â”‚   â”‚   â””â”€â”€ item_service.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/            # ìš”ì²­/ì‘ë‹µ ë°ì´í„° ìŠ¤í‚¤ë§ˆ (Pydantic)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ users.py
â”‚   â”‚   â””â”€â”€ items.py
â”‚   â”‚
â”‚   â””â”€â”€ routes/             # API ë¼ìš°í„°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ v1/             # API ë²„ì „ë³„ ë””ë ‰í† ë¦¬
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ users.py
â”‚       â”‚   â””â”€â”€ items.py
â”‚       â””â”€â”€ v2/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â””â”€â”€ users.py
â”‚
â””â”€â”€ tests/                  # í…ŒìŠ¤íŠ¸ ì½”ë“œ
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_users.py
    â””â”€â”€ test_items.py
```

<br>

| êµ¬ì„±ìš”ì†Œ| ì—­í• | ì‹¤ë¬´ ì´ìœ | ì˜ˆì‹œ íŒŒì¼ëª…|
| --- | --- | --- | --- |
| `main.py`| FastAPI ì•± ì§„ì…ì . ë¼ìš°í„°, ë¯¸ë“¤ì›¨ì–´ ë“±ë¡ ë° ì•± ì‹¤í–‰ | ì•± êµ¬ë™ì˜ ì‹œì‘ì . ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ë° ì„œë²„ ì‹¤í–‰ í™˜ê²½ ì„¤ì • ì§‘ì¤‘| `main.py`|
| `core/`| í™˜ê²½ ì„¤ì • ë° ë³´ì•ˆ ìœ í‹¸ë¦¬í‹° (JWT, í•´ì‹œ ë“±)| í™˜ê²½ë³„(dev/prod) ì„¤ì • ê´€ë¦¬ ë° ë³´ì•ˆ ëª¨ë“ˆ ì¼ì›í™”| `core/config.py`|
| `dependencies/`| ê³µí†µ ì˜ì¡´ì„± ê´€ë¦¬ (DB ì„¸ì…˜, ì¸ì¦ í† í° ë“±)| ì˜ì¡´ì„± ì£¼ì…ìœ¼ë¡œ ì½”ë“œ ì¬ì‚¬ìš© â†‘, í…ŒìŠ¤íŠ¸ ìš©ì´| `dependencies/db.py`|
| `models/`| ORM DB ëª¨ë¸ ì •ì˜| DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ API ì½”ë“œ ì˜í–¥ ìµœì†Œí™” â†’ ë…ë¦½ì„± â†‘| `models/users.py`|
| `repositories/`| DB ì ‘ê·¼ ê³„ì¸µ. Service â†” DB ì¤‘ê°„ ê³„ì¸µ| Serviceì—ì„œ ì§ì ‘ DB ì„¸ì…˜ ì‚¬ìš© X â†’ í…ŒìŠ¤íŠ¸ ìš©ì´, ìœ ì§€ë³´ìˆ˜ â†‘ | `repositories/user_repo.py`|
| `services/`| ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬ ê³„ì¸µ| ë¼ìš°í„°ì™€ DB ì½”ë“œ ë¶„ë¦¬ â†’ ì„œë¹„ìŠ¤ ë¡œì§ ì¬ì‚¬ìš©ì„±/í…ŒìŠ¤íŠ¸ ìš©ì´ â†‘| `services/user_service.py`|
| `schemas/`| ìš”ì²­/ì‘ë‹µ ë°ì´í„° êµ¬ì¡° ì •ì˜ + ê²€ì¦(Pydantic)| ë°ì´í„° ê²€ì¦ ìë™í™” + Swagger ë¬¸ì„œ ìƒì„±| `schemas/users.py`|
| `routes/`| API ë¼ìš°í„° ì •ì˜. URLë³„, ë²„ì „ë³„ ëª¨ë“ˆí™”| API ê¸°ëŠ¥ë³„ ë¶„ë¦¬ + ë²„ì €ë‹ ì§€ì› â†’ ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ í˜‘ì—… ìš©ì´| `routes/v1/users.py`|
| `tests/`| ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì½”ë“œ| ì•ˆì •ì„± í™•ë³´ ë° CI/CD í†µí•© ì‹œ í•„ìˆ˜| `tests/test_users.py`|


<br>
#### í•µì‹¬ ìš”ì•½

```md
ğŸ“¦ main.py         â†’ ì•± ì‹¤í–‰ ì§„ì…ì 
ğŸ“¦ core/           â†’ ì „ì—­ ì„¤ì • ë° ë³´ì•ˆ ê´€ë¦¬
ğŸ“¦ dependencies/   â†’ ê³µí†µ ì˜ì¡´ì„± ê´€ë¦¬ (DB ì„¸ì…˜, ì¸ì¦ ë“±)
ğŸ“¦ models/         â†’ ORM DB ëª¨ë¸ ì •ì˜ (SQLAlchemy)
ğŸ“¦ repositories/   â†’ DB ì ‘ê·¼ ê³„ì¸µ (Service â†” DB ë¶„ë¦¬)
ğŸ“¦ services/       â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µí™”
ğŸ“¦ schemas/        â†’ Pydantic ë°ì´í„° ê²€ì¦
ğŸ“¦ routes/         â†’ API URL + ë©”ì„œë“œ ì •ì˜, ë²„ì €ë‹ ì§€ì›
ğŸ“¦ tests/          â†’ ë‹¨ìœ„Â·í†µí•© í…ŒìŠ¤íŠ¸ ì½”ë“œ
```


<br>
<br>

## A-1. FastAPI ì•± ì‹¤í–‰ íë¦„

```css
[Client ìš”ì²­]
      â‡…
[Uvicorn (ASGI ì„œë²„)]
      â†“
[Starlette]
  - ë¯¸ë“¤ì›¨ì–´ (ìš”ì²­ ì „ ì²˜ë¦¬)
      â†“
[FastAPI ë¼ìš°í„°]
  - URL ë§¤ì¹­
  - ì˜ì¡´ì„± ì£¼ì… (Depends)
  - ì—”ë“œí¬ì¸íŠ¸ í•¨ìˆ˜ ì‹¤í–‰
  - ì„œë¹„ìŠ¤ ê³„ì¸µ í˜¸ì¶œ
      â†“
[Pydantic]
  - ìš”ì²­ ë°ì´í„° ê²€ì¦
  - ì‘ë‹µ ë°ì´í„° ê²€ì¦
      â†“
[Starlette]
  - ë¯¸ë“¤ì›¨ì–´ (ì‘ë‹µ í›„ ì²˜ë¦¬)
      â†“
[í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ ë°˜í™˜]
```

<br>
<br>
<br>
<br>

## B. ì—”ë“œí¬ì¸íŠ¸ (Endpoint)
* í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” APIì˜ **URL + ë©”ì„œë“œ** ì¡°í•©

> * **`URL + ë©”ì„œë“œ` ë‹¹ í•˜ë‚˜ì˜ ì—”ë“œí¬ì¸íŠ¸**
* í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œ "ìš”ì²­ì„ ë³´ë‚´ë©´ ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ” ì£¼ì†Œ"
* API ì—”ë“œí¬ì¸íŠ¸ ì˜ˆì‹œ

<br>

|ë©”ì„œë“œ|URL|ì„¤ëª…|
|---|---|---|
|GET|`/users/`|ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ|
|GET|`/users/{id}`|íŠ¹ì • ì‚¬ìš©ì ì¡°íšŒ|
|POST|`/users/`|ìƒˆ ì‚¬ìš©ì ì¶”ê°€|
|PUT|`/users/{id}`|ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •|
|DELETE|`/users/{id}`|ì‚¬ìš©ì ì‚­ì œ|

<br>

### ì½”ë“œ ì˜ˆì œ
```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/users/")
def get_users():
    return [{"username": "alice"}, {"username": "bob"}]

@app.post("/users/")
def create_user(user: dict):
    return {"message": "ì‚¬ìš©ì ìƒì„± ì™„ë£Œ", "user": user}
```

<br>

* ìœ„ ì˜ˆì œëŠ” ì—”ë“œí¬ì¸íŠ¸ 2ê°œ
* í•˜ë‚˜ì˜ URLì— 2ê°œì˜ ë©”ì„œë“œê°€ ìˆìŒ (URLë‹¹ í•˜ë‚˜ì˜ ë©”ì„œë“œë§Œ ì¡´ì¬í•  ìˆ˜ ìˆìŒ)
> * URL + ë©”ì„œë“œ(GET/POST/PUT/DELETE ë“±) ì¡°í•©ìœ¼ë¡œ ìœ ì¼
> * ê° ì—”ë“œí¬ì¸íŠ¸ë§ˆë‹¤ ì²˜ë¦¬ í•¨ìˆ˜ ì—°ê²°

<br>
<br>
<br>
<br>

## C. ë¯¸ë“¤ì›¨ì–´ (Middleware)
* ìš”ì²­(Request)ì´ ë¼ìš°íŠ¸ í•¸ë“œëŸ¬(ê²½ë¡œ ì‘ë™ í•¨ìˆ˜)ì— ë„ë‹¬í•˜ê¸° ì „ê³¼, ì‘ë‹µ(Response)ì´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬ë˜ê¸° ì „ íŠ¹ì • ë¡œì§ì„ ì‹¤í–‰í•˜ë„ë¡ í•˜ëŠ” í•¨ìˆ˜ ë˜ëŠ” í´ë˜ìŠ¤
> * ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  ìš”ì²­ê³¼ ì‘ë‹µì´ ê±°ì³ì•¼ í•˜ëŠ” 'ì¤‘ê°„ ê²€ë¬¸ì†Œ'

<br>

```
[í´ë¼ì´ì–¸íŠ¸ ìš”ì²­]
      â†“
ë¯¸ë“¤ì›¨ì–´ (ìš”ì²­ ì „ ì²˜ë¦¬)
      â†“
ë¼ìš°í„° (URL ë§¤ì¹­ â†’ í•¨ìˆ˜ ì‹¤í–‰)
      â†“
ë¯¸ë“¤ì›¨ì–´ (ì‘ë‹µ í›„ ì²˜ë¦¬)
      â†“
[í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ]
```

<br>
<br>

### C-1. ë¯¸ë“¤ì›¨ì–´ì˜ ì‚¬ìš© ì´ìœ 
> * ì—¬ëŸ¬ ê²½ë¡œì— ê±¸ì³ ë°˜ë³µì ìœ¼ë¡œ í•„ìš”í•œ 'íš¡ë‹¨ ê´€ì‹¬ì‚¬(Cross-cutting concerns)'ë¥¼ ì²˜ë¦¬í•˜ëŠ”ë° ìœ ìš©

<br>

|ëª©ì |ë‚´ìš©|
|---|---|
|ì¸ì¦/ì¸ê°€|ìš”ì²­ í—¤ë”ì— ìˆëŠ” í† í°ì´ë‚˜ ì„¸ì…˜ì„ ê²€ì¦í•˜ì—¬ íŠ¹ì • ê²½ë¡œì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ í™•ì¸|
|ë¡œê¹…(Logging)|ëª¨ë“  ìš”ì²­ê³¼ ì‘ë‹µì— ëŒ€í•œ ì •ë³´ë¥¼ ê¸°ë¡í•˜ì—¬ ë””ë²„ê¹…ì´ë‚˜ ëª¨ë‹ˆí„°ë§ì— í™œìš©|
|ì„±ëŠ¥ ì¸¡ì •|ê° ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì¸¡ì •í•˜ì—¬ ì‘ë‹µ í—¤ë”ì— ì¶”ê°€|
|CORS(Cross-Origin Resource Sharing) ì„¤ì •|ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œì˜ ìš”ì²­ì„ í—ˆìš©í•˜ê¸° ìœ„í•œ í—¤ë” ì¶”ê°€|
|ì—ëŸ¬ ì²˜ë¦¬|ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸(Exception)ë¥¼ ì¼ê´„ì ìœ¼ë¡œ ì¡ì•„ë‚´ì–´ í‘œì¤€í™”ëœ ì—ëŸ¬ ì‘ë‹µ ì „ë‹¬|
|ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ê´€ë¦¬|ê° ìš”ì²­ë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ì„ ì—´ê³ , ìš”ì²­ ì²˜ë¦¬ê°€ ëë‚˜ë©´ ì„¸ì…˜ ë‹«ìŒ|

<br>
<br>

### C-2. ì‚¬ìš© ë°©ë²• 1 - `@app.middleware("http")` ë°ì½”ë ˆì´í„° ì‚¬ìš©
* `async` í•¨ìˆ˜ì— ë°ì½”ë ˆì´í„°ë¥¼ ë¶™ì—¬ì„œ ë¯¸ë“¤ì›¨ì–´ ì •ì˜
```python
# ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì²˜ë¦¬ ì‹œê°„ì„ ê³„ì‚°í•˜ê³ , ê·¸ ê°’ì„ X-Process-Timeì´ë¼ëŠ” ì»¤ìŠ¤í…€ í—¤ë”ì— ë‹´ì•„ ì‘ë‹µí•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ ì˜ˆì œ

import time
from fastapi import FastAPI, Request

app = FastAPI()

# ë¯¸ë“¤ì›¨ì–´ ì •ì˜
@app.middleware("http")
async def add_process_time_header(request: Request, call_next):
    # 1. ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ì²˜ë¦¬í•  ë¡œì§
    start_time = time.time()

    # 2. ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ ë˜ëŠ” ê²½ë¡œë¡œ ìš”ì²­ì„ ì „ë‹¬í•˜ê³  ì‘ë‹µì„ ë°›ìŒ
    response = await call_next(request)

    # 3. ì‘ë‹µì´ ë‚˜ê°ˆ ë•Œ ì²˜ë¦¬í•  ë¡œì§
    process_time = time.time() - start_time
    response.headers["X-Process-Time"] = str(process_time) # í—¤ë” ì¶”ê°€

    return response

# ë¯¸ë“¤ì›¨ì–´ê°€ ì ìš©ë  ê²½ë¡œ
@app.get("/")
async def root():
    return {"message": "Hello, World"}

@app.get("/items/{item_id}")
async def read_item(item_id: int):
    return {"item_id": item_id}
```

<br>
<br>

### C-2. ì‚¬ìš© ë°©ë²• 2 - `app.add_middleware()` ì‚¬ìš©
* FastAPIê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ê±°ë‚˜, ì§ì ‘ í´ë˜ìŠ¤ë¡œ ë§Œë“  ASGI ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€ ì‹œ ì‚¬ìš©
> * ì¬ì‚¬ìš©ì„±ì´ ë†’ê³  ì„¤ì •ì´ í•„ìš”í•  ë•Œ ìœ ìš©

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

# í—ˆìš©í•  ì¶œì²˜(origin) ëª©ë¡
origins = [
    "http://localhost",
    "http://localhost:8080",
    "https://my-frontend.com",
]

# CORS ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€
app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,          # í—ˆìš©í•  ì¶œì²˜
    allow_credentials=True,       # ì¿ í‚¤ í—ˆìš© ì—¬ë¶€
    allow_methods=["*"],          # í—ˆìš©í•  HTTP ë©”ì†Œë“œ
    allow_headers=["*"],          # í—ˆìš©í•  HTTP í—¤ë”
)

@app.get("/")
async def root():
    return {"message": "CORS is configured!"}
```

<br>
<br>

### C-3. ì¤‘ìš”ì‚¬í•­
* ë¯¸ë“¤ì›¨ì–´ ìˆœì„œ: ë¯¸ë“¤ì›¨ì–´ëŠ” ì¶”ê°€ëœ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë¨
> * ë¨¼ì € ì¶”ê°€ëœ ë¯¸ë“¤ì›¨ì–´ê°€ ìš”ì²­ì„ ê°€ì¥ ë¨¼ì € ë°›ê³ , ì‘ë‹µì€ ê°€ì¥ ë‚˜ì¤‘ì— ë³´ëƒ„
> * ìˆœì„œê°€ ì¤‘ìš”í•œ ë¡œì§(ë¡œê¹… í›„ ì¸ì¦ ë“±)ì„ êµ¬í˜„í•  ë•Œ ì£¼ì˜í•´ì•¼í•¨
* ASGI ë©”ë“¤ì›¨ì–´
> * FastAPIëŠ” Starletteì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, Starletteì€ ASGI í‘œì¤€ì„ ë”°ë¦„
> * ë”°ë¼ì„œ FastAPI ë¯¸ë“¤ì›¨ì–´ëŠ” ìˆœìˆ˜í•œ ASGI ë¯¸ë“¤ì›¨ì–´ì™€ í˜¸í™˜ë¨

<br>
<br>

### C-4. ë¯¸ë“¤ì›¨ì–´ vs ì—”ë“œí¬ì¸íŠ¸ vs ì˜ì¡´ì„±(Dependencies)
| êµ¬ë¶„| ë¯¸ë“¤ì›¨ì–´| ì—”ë“œí¬ì¸íŠ¸| Depends|
| --- | --- | --- | --- |
| ì ìš© ë²”ìœ„ | ì•± ì „ì²´ ìš”ì²­/ì‘ë‹µ| íŠ¹ì • URL + ë©”ì„œë“œ| íŠ¹ì • ë¼ìš°í„°/ì—”ë“œí¬ì¸íŠ¸|
| ì²˜ë¦¬ ì‹œì  | ìš”ì²­ ì „í›„| URL ë§¤ì¹­ í›„ì—ë§Œ ì‹¤í–‰| ì—”ë“œí¬ì¸íŠ¸ í•¨ìˆ˜ ì‹¤í–‰ ì‹œ|
| ì£¼ ìš©ë„  | ì¸ì¦, ë¡œê¹…, ê³µí†µ í—¤ë”| ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬| DB ì„¸ì…˜, ì¸ì¦, ê³µí†µ íŒŒë¼ë¯¸í„° ì£¼ì… |
| ì½”ë“œ ìœ„ì¹˜ | `@app.middleware` ë˜ëŠ” `add_middleware()` | `@app.get`, `@app.post` | `Depends()` ì‚¬ìš©|

<br>
<br>
<br>
<br>

## D. ë¼ìš°í„°(Router)
* í´ë¼ì´ì–¸íŠ¸ì˜ HTTP ìš”ì²­(URL + ë©”ì„œë“œ)ì„ ë°›ì•„ì„œ "ì–´ë–¤ ì²˜ë¦¬ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í• ì§€"ë¥¼ ê²°ì •í•˜ëŠ” ë§¤í•‘ ì—”ì§„
* Pythonì—ì„œ ê´€ë ¨ ë©”ì„œë“œë“¤ì„ í•˜ë‚˜ì˜ `.py` íŒŒì¼ì— ëª°ì•„ë„£ëŠ” ê²ƒê³¼ ìœ ì‚¬í•œ ê°œë…
* í•˜ì§€ë§Œ FastAPIì˜ **APIRouterëŠ”** ë‹¨ìˆœ ëª¨ë“ˆí™”ë¥¼ ë„˜ì–´ì„œ ë‹¤ìŒ ìš”ì†Œë“¤ ì¶”ê°€ ê°€ëŠ¥
> * prfix: ê³µí†µ URL ì ‘ë‘ì‚¬ë¡œ API ê³„ì¸µí™”
> * tags: Swagger UIì—ì„œ API ë¬¸ì„œë¥¼ ê·¸ë£¹í™”
> * dependencies: ë¼ìš°í„° ë‹¨ìœ„ ê³µí†µ ì˜ì¡´ì„± ì£¼ì…

<br>

|ì—­í• |ì„¤ëª…|
|---|---|
|URL ë§¤í•‘|URL ê²½ë¡œì™€ HTTP ë©”ì„œë“œë¥¼ ì²˜ë¦¬ í•¨ìˆ˜ì— ì—°ê²°|
|API ëª¨ë“ˆí™”|ì—”ë“œí¬ì¸íŠ¸ë“¤ì„ ê¸°ëŠ¥ë³„ë¡œ ë¶„ë¦¬ ê´€ë¦¬|
|Swagger ë¬¸ì„œ ê·¸ë£¹í™”|tags ì‚¬ìš©í•´ API ë¬¸ì„œë¥¼ ê·¸ë£¹ë³„ë¡œ ì •ë¦¬|
|prefix ì„¤ì •|ê³µí†µ URL ì ‘ë‘ì‚¬(prefix)ë¥¼ ë¶™ì—¬ ë¼ìš°í„° ë…ë¦½ì„± ìœ ì§€|
|ì˜ì¡´ì„± ì£¼ì…|ë¼ìš°í„° ìˆ˜ì¤€ì—ì„œ Depends()ë¡œ ê³µí†µ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥|

<br>

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/")
def get_items():
    return {"items": ["Apple", "Banana"]}
```

* í´ë¼ì´ì–¸íŠ¸ê°€ GET /items/ ìš”ì²­ â†’ `get_items()` ì‹¤í–‰

* `@app.get("/items/")` ì´ê²Œ ë°”ë¡œ ë¼ìš°í„°

<br>
<br>

### D-1. ë¼ìš°í„° ëª¨ë“ˆí™”
* `app/routes/users.py`
```python
from fastapi import APIRouter

router = APIRouter()

@router.get("/")
def get_users():
    return [{"username": "alice"}, {"username": "bob"}]

@router.get("/{user_id}")
def get_user(user_id: int):
    return {"username": f"user{user_id}"}
```

<br>

* `app/routes/items.py`
```python
from fastapi import APIRouter

router = APIRouter()

@router.get("/")
def get_items():
    return [{"name": "Keyboard", "price": 49.99},
            {"name": "Mouse", "price": 19.99}]

@router.post("/")
def create_item(item: dict):
    return {"message": "ì•„ì´í…œ ìƒì„± ì™„ë£Œ", "item": item}
```

<br>

* `main.py`
```python
from fastapi import FastAPI
from app.routes import users, items

app = FastAPI()

# users ë¼ìš°í„° ë“±ë¡
app.include_router(users.router, prefix="/users", tags=["Users"])

# items ë¼ìš°í„° ë“±ë¡
app.include_router(items.router, prefix="/items", tags=["Items"])
```

<br>
<br>
<br>
<br>

## E. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
* ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”ì¸ ê¸°ëŠ¥
> * ì•±ì´ ì œê³µí•˜ëŠ” í•µì‹¬ ê¸°ëŠ¥ê³¼ ê·œì¹™(ì—…ë¬´ ê·œì¹™)ì„ ì½”ë“œë¡œ êµ¬í˜„í•œ ê²ƒ

|êµ¬ë¶„|ì„¤ëª…|
|---|---|
|ğŸŸ£ ë¯¸ë“¤ì›¨ì–´|ëª¨ë“  ìš”ì²­/ì‘ë‹µì— ì ìš©ë˜ëŠ” ê³µí†µ ì²˜ë¦¬|
|ğŸŸ¢ ë¼ìš°í„°|URLê³¼ HTTP ë©”ì„œë“œ ë§¤í•‘ â†’ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬|
|ğŸ”¥ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§|ì‹¤ì œ ìš”ì²­ ì²˜ë¦¬ í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„|
